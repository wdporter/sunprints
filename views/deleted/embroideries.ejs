<%- include("../partials/head.ejs") %>

<p>
	<a href="/embroidery">Go to embrodiery designs page</a>
</p>


<table id="dt" class="hover stripe">
	<thead>
		<tr>
			<th></th>
			<th>Code</th>
			<th>Notes</th>
			<th>Comments</th>
			<th>Deleted By</th>
			<th>Deleted Date Time</th>
		</tr>
	</thead>
	<tbody></tbody>
</table>


<script>
	window.datatable = new DataTable("#dt", {
		ajax: {
			url: "/embroidery/deleted/dt",
			method: "POST"
		},
		processing: true,
		serverSide: true,
		order: [[5, 'desc']],
		columns: [
			{
				data: "EmbroideryDesignId",
				render(data) {
					return `<button onclick="restore(${data})">Restore</button>`
				}
			},
			{ data: "Code"},
			{ data: "Notes"},
			{ data: "Comments"},
			{ data: "LastModifiedBy" },
			{ data: "LastModifiedDateTime" }
		]
	})
	

	function restore(id) {
		const tr = document.querySelector(`tr[data-id="${id}"]`)

		fetch(`/embroidery/restore/${id}`, { method: "PUT" })
		.then(response => {
			if (response.ok) {
				window.datatable.row(tr).remove().draw("page")
			}
			else {
				throw new Error(response.statusText)
			}
		})
		.catch(err => window.alert(`We encountered an error: ${response.statusText}`))
	}
</script>


<%- include('../partials/foot.ejs'); %>
