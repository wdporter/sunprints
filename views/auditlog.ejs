<%- include("partials/head.ejs") %>

<script type="module">
import { createApp, ref, onMounted, watch } from "vue"
import Vue3EasyDataTable from "vue3easydatatable";

const App = {
	components: { EasyDataTable: Vue3EasyDataTable },
	setup() {
		const message = ref("Hello World!");
		const headers = ref([
        { text: "", value: "AuditLogId", sortable: true },
        { text: "Table", value: "ObjectName", sortable: true},
        { text: "Id", value: "Identifier", sortable: true},
        { text: "Action", value: "AuditAction", sortable: true},
        { text: "Created By", value: "CreatedBy", sortable: true},
        { text: "Created Date/Time", value: "CreatedDateTime", sortable: true, width: 180}
      ]);
		const items = ref([]);
		const loading = ref(false);
		const serverOptions = ref({
			page: 1,
			rowsPerPage: 100,
			sortBy: "AuditLogId",
			sortType: "DESC"
		});
		const themeColor = "darkorange";
		const serverItemsLength = ref(0);

		const loadFromServer = async () => {
			console.log ("Load from server");
			loading.value = true;
			const response = await fetch("/auditlog/edt", {
				method: "POST",
				headers: new Headers({"Content-Type": "application/json"}),
				body: JSON.stringify(serverOptions.value)
			});
			try {
				const result = await response.json();
				items.value = result.data;
				serverItemsLength.value = result.count;
			} catch (error) {
				console.log(error)
			}
			finally {
				loading.value = false;
			}
		};

		onMounted(() => {
			loadFromServer();
		});

		watch(serverOptions, (value) => {loadFromServer();}, {deep: true})

		return {
			message,
			headers,
			items,
			loading,
			loadFromServer,
			serverOptions,
			serverItemsLength,
			themeColor
		}
	}
}

const app = createApp(App)
//app.
app.mount("#app")

</script>

<div id=app>
	<h1>{{ message }}</h1>
	<easy-data-table
	v-model:server-options="serverOptions" 
	:server-items-length="serverItemsLength" 
	:loading="loading"
	:headers="headers"
	:items="items"
	:theme-color="themeColor"
	alternating
	must-sort
	buttons-pagination
/>
</div>


<%- include('partials/foot.ejs'); %>